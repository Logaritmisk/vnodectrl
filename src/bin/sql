#!/bin/bash

# api_version=1


sql_info() {
    echo "Control MySQL on guest system"
}

sql_exec() {
    local \
        guest_user=$(vnode_identity_get 'guest_user') \
        guest_pass=$(vnode_identity_get 'guest_pass') \
        guest_addr=$(vnode_identity_get 'guest_addr')


    case $1 in
    	cli)
    		ssh -qt -oStrictHostKeyChecking=no $guest_user@$guest_addr "mysql -uroot"
    		
    		return $?
    	;;
    	dump)
    		ssh -qt -oStrictHostKeyChecking=no $guest_user@$guest_addr "sudo -k; echo $guest_pass | sudo -S ~/guest/sql-dump.sh" | tail -n +1
    		
    		R=$?
    		if [ ! $R -eq 0 ]; then
    		    echo "Error: $R"
    		fi
    		
    		return 0
    	;;
    	restore)
    		ssh -qt -oStrictHostKeyChecking=no $guest_user@$guest_addr "sudo -k; echo $guest_pass | sudo -S ~/guest/sql-restore.sh" | tail -n +1
    		
    		R=$?
            if [ ! $R -eq 0 ]; then
                echo "Error: $R"
            fi
    		
    		return 0
    	;;
    	*)
    		echo "Usage: `basename $0` {cli|dump|restore}"
    		
    		return 1
    	;;
    esac
}
